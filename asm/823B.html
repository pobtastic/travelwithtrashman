<!DOCTYPE html>
<html>
<head>
<title>Travel With Trashman: Routine at 823B</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="81D4.html">81D4</a>
</td>
<td class="up">Up: <a href="../maps/all.html#823b">Map</a></td>
<td class="next">
Next: <a href="835F.html">835F</a>
</td>
</tr>
</table>
<div class="description">823B: Generate Ticker Messaging</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="81D4.html">Handler_Ticker</a>, <a href="8666.html">ChooseLocationOrTakeJob</a>, <a href="8749.html">Handler_LocationChoice</a> and <a href="883C.html">Handler_SubGame</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="823b"></span>
<div class="comments">
<div class="paragraph">
These examples are generated with the location being "London" so obviously aren't possible to see in the actual game (given London isn't a playable level - that's the first game!)
</div>
<div class="paragraph">
Note, this isn't a complete list - as some vary with the bonus points messaging:   <table class="default">
<tr>
<th colspan="1" rowspan="1">Bit</th>
<th colspan="1" rowspan="1">Message</th>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">01</td>
<td class="" colspan="1" rowspan="1"><img alt="ticker-01" src="../images/font/ticker-01.png" /></td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">02</td>
<td class="" colspan="1" rowspan="1"><img alt="ticker-02" src="../images/font/ticker-02.png" /></td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">03</td>
<td class="" colspan="1" rowspan="1"><img alt="ticker-03" src="../images/font/ticker-03.png" /></td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">04</td>
<td class="" colspan="1" rowspan="1"><img alt="ticker-04" src="../images/font/ticker-04.png" /></td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">05</td>
<td class="" colspan="1" rowspan="1"><img alt="ticker-05" src="../images/font/ticker-05.png" /></td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">06</td>
<td class="" colspan="1" rowspan="1"><img alt="ticker-06" src="../images/font/ticker-06.png" /></td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">07</td>
<td class="" colspan="1" rowspan="1"><img alt="ticker-07" src="../images/font/ticker-07.png" /></td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Messaging_GenerateTicker</td>
<td class="address-2"><span id="823b"></span>823B</td>
<td class="instruction">CALL <a href="835F.html">InitialiseTickerBuffer</a></td>
<td class="comment-1" rowspan="1">Call <a href="835F.html">InitialiseTickerBuffer</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="823e"></span>
<div class="comments">
<div class="paragraph">
Test if the player has been deported from Russia.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="823e"></span>823E</td>
<td class="instruction">LD HL,$EFFA</td>
<td class="comment-1" rowspan="3">Jump to <a href="823B.html#826f">Ticker_CheckKilledInSpain</a> if the player hasn't been "deported from Russia".</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8241"></span>8241</td>
<td class="instruction">BIT 2,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8243"></span>8243</td>
<td class="instruction">JR Z,<a href="823B.html#826f">Ticker_CheckKilledInSpain</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8245"></span>
<div class="comments">
<div class="paragraph">
Player has been deported from Russia, so handle displaying the messaging in the ticker.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8245"></span>8245</td>
<td class="instruction">RES 2,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 2 ("Deported From Russia") in *<a href="EFFA.html">GameState_1</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8247"></span>8247</td>
<td class="instruction">RES 0,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 0 of *<a href="EFFA.html">GameState_1</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8249"></span>
<div class="comments">
<div class="paragraph">
Build the string in the ticker buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8249"></span>8249</td>
<td class="instruction">LD HL,$8CF0</td>
<td class="comment-1" rowspan="2">Adds ... " deported from Russia, FO says rubbish." to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="824c"></span>824C</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="824f"></span>824F</td>
<td class="instruction">LD A,$5A</td>
<td class="comment-1" rowspan="1">Set the spacing to 5A in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8251"></span>8251</td>
<td class="instruction">LD HL,$EFFA</td>
<td class="comment-1" rowspan="3">Jump to <a href="837F.html">AddSpacingFillTickerBuffer</a> if the player has no bonus points.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8254"></span>8254</td>
<td class="instruction">BIT 1,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8256"></span>8256</td>
<td class="instruction">JP Z,<a href="837F.html">AddSpacingFillTickerBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8259"></span>8259</td>
<td class="instruction">RES 1,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 1 ("Has Bonus Points?") of *<a href="EFFA.html">GameState_1</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="825b"></span>825B</td>
<td class="instruction">LD HL,$8D17</td>
<td class="comment-1" rowspan="2">Adds ... " He denies smuggling out " to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="825e"></span>825E</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8261"></span>8261</td>
<td class="instruction">CALL <a href="823B.html#8335">AddBonusPointsToTicker</a></td>
<td class="comment-1" rowspan="1">Adds the players bonus points to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8264"></span>8264</td>
<td class="instruction">LD HL,$8DB1</td>
<td class="comment-1" rowspan="2">Adds ... " bonus pts." to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8267"></span>8267</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="826a"></span>826A</td>
<td class="instruction">LD A,$78</td>
<td class="comment-1" rowspan="2">Set the spacing to 78 and jump to <a href="837F.html">AddSpacingFillTickerBuffer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="826c"></span>826C</td>
<td class="instruction">JP <a href="837F.html">AddSpacingFillTickerBuffer</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="826f"></span>
<div class="comments">
<div class="paragraph">
Test if the player has been hit by the bull in Madrid.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Ticker_CheckKilledInSpain</td>
<td class="address-2"><span id="826f"></span>826F</td>
<td class="instruction">BIT 3,(HL)</td>
<td class="comment-1" rowspan="2">Jump to <a href="823B.html#829d">Ticker_CheckSubGameWasSuccess</a> if the player has not been hit by the bull.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8271"></span>8271</td>
<td class="instruction">JR Z,<a href="823B.html#829d">Ticker_CheckSubGameWasSuccess</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8273"></span>
<div class="comments">
<div class="paragraph">
Player has been hit by the bull, so handle displaying the messaging in the ticker.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8273"></span>8273</td>
<td class="instruction">RES 3,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 3 ("Hit By The Bull") of *<a href="EFFA.html">GameState_1</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8275"></span>8275</td>
<td class="instruction">RES 0,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 0 of *<a href="EFFA.html">GameState_1</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8277"></span>
<div class="comments">
<div class="paragraph">
Build the string in the ticker buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8277"></span>8277</td>
<td class="instruction">LD HL,$8D30</td>
<td class="comment-1" rowspan="2">Adds ... " killed in Spain, while crowd cheers." to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="827a"></span>827A</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="827d"></span>827D</td>
<td class="instruction">LD A,$55</td>
<td class="comment-1" rowspan="1">Set the spacing to 55 in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="827f"></span>827F</td>
<td class="instruction">LD HL,$EFFA</td>
<td class="comment-1" rowspan="3">Jump to <a href="837F.html">AddSpacingFillTickerBuffer</a> if the player has no bonus points.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8282"></span>8282</td>
<td class="instruction">BIT 1,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8284"></span>8284</td>
<td class="instruction">JP Z,<a href="837F.html">AddSpacingFillTickerBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8287"></span>8287</td>
<td class="instruction">RES 1,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 1 ("Has Bonus Points?") of *<a href="EFFA.html">GameState_1</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8289"></span>8289</td>
<td class="instruction">LD HL,$8D55</td>
<td class="comment-1" rowspan="2">Adds ... " His " to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="828c"></span>828C</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="828f"></span>828F</td>
<td class="instruction">CALL <a href="823B.html#8335">AddBonusPointsToTicker</a></td>
<td class="comment-1" rowspan="1">Adds the players bonus points to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8292"></span>8292</td>
<td class="instruction">LD HL,$8D5A</td>
<td class="comment-1" rowspan="2">Adds ... " Bonus pts. will be flown back to the U.K. today." to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8295"></span>8295</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8298"></span>8298</td>
<td class="instruction">LD A,$8E</td>
<td class="comment-1" rowspan="2">Set the spacing to 8E and jump to <a href="837F.html">AddSpacingFillTickerBuffer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="829a"></span>829A</td>
<td class="instruction">JP <a href="837F.html">AddSpacingFillTickerBuffer</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="829d"></span>
<div class="comments">
<div class="paragraph">
Did the player manage to complete the sub-game?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Ticker_CheckSubGameWasSuccess</td>
<td class="address-2"><span id="829d"></span>829D</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-1" rowspan="2">Jump to <a href="823B.html#82b7">Ticker_CheckSubGameWasSuccess_WithBonusPoints</a> if bit 0 of *<a href="EFFA.html">GameState_1</a> is not set.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="829f"></span>829F</td>
<td class="instruction">JR Z,<a href="823B.html#82b7">Ticker_CheckSubGameWasSuccess_WithBonusPoints</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82a1"></span>82A1</td>
<td class="instruction">RES 0,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 0 of *<a href="EFFA.html">GameState_1</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="82a3"></span>
<div class="comments">
<div class="paragraph">
Build the string in the ticker buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82a3"></span>82A3</td>
<td class="instruction">LD HL,$8D8B</td>
<td class="comment-1" rowspan="2">Adds ... " successfully cleans up " to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82a6"></span>82A6</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82a9"></span>82A9</td>
<td class="instruction">CALL <a href="836E.html">AddLocationTickerBuffer</a></td>
<td class="comment-1" rowspan="1">Add the current location name to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82ac"></span>82AC</td>
<td class="instruction">LD HL,$8DA3</td>
<td class="comment-1" rowspan="2">Adds ... " ." to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82af"></span>82AF</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82b2"></span>82B2</td>
<td class="instruction">LD A,$5A</td>
<td class="comment-1" rowspan="2">Set the spacing to 5A and jump to <a href="837F.html">AddSpacingFillTickerBuffer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82b4"></span>82B4</td>
<td class="instruction">JP <a href="837F.html">AddSpacingFillTickerBuffer</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="82b7"></span>
<div class="comments">
<div class="paragraph">
As above, but also with bonus points.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Ticker_CheckSubGameWasSuccess_WithBonusPoints</td>
<td class="address-2"><span id="82b7"></span>82B7</td>
<td class="instruction">BIT 1,(HL)</td>
<td class="comment-1" rowspan="2">Jump to <a href="823B.html#82da">Ticker_CheckStranded</a> if the player has no bonus points.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82b9"></span>82B9</td>
<td class="instruction">JR Z,<a href="823B.html#82da">Ticker_CheckStranded</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="82bb"></span>
<div class="comments">
<div class="paragraph">
Player has completed the sub-game and has bonus points, so handle displaying the messaging in the ticker.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82bb"></span>82BB</td>
<td class="instruction">RES 1,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 1 ("Has Bonus Points?") of *<a href="EFFA.html">GameState_1</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="82bd"></span>
<div class="comments">
<div class="paragraph">
Build the string in the ticker buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82bd"></span>82BD</td>
<td class="instruction">LD HL,$8D8B</td>
<td class="comment-1" rowspan="2">Adds ... " successfully cleans up " to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82c0"></span>82C0</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82c3"></span>82C3</td>
<td class="instruction">CALL <a href="836E.html">AddLocationTickerBuffer</a></td>
<td class="comment-1" rowspan="1">Add the current location name to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82c6"></span>82C6</td>
<td class="instruction">LD HL,$8DA5</td>
<td class="comment-1" rowspan="2">Adds ... "  and gains " to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82c9"></span>82C9</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82cc"></span>82CC</td>
<td class="instruction">CALL <a href="823B.html#8335">AddBonusPointsToTicker</a></td>
<td class="comment-1" rowspan="1">Add the players bonus points to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82cf"></span>82CF</td>
<td class="instruction">LD HL,$8DB1</td>
<td class="comment-1" rowspan="2">Adds ... " bonus pts." to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82d2"></span>82D2</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82d5"></span>82D5</td>
<td class="instruction">LD A,$6E</td>
<td class="comment-1" rowspan="2">Set the spacing to 6E and jump to <a href="837F.html">AddSpacingFillTickerBuffer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82d7"></span>82D7</td>
<td class="instruction">JP <a href="837F.html">AddSpacingFillTickerBuffer</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="82da"></span>
<div class="comments">
<div class="paragraph">
Is the player out of money and stranded in their current location?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Ticker_CheckStranded</td>
<td class="address-2"><span id="82da"></span>82DA</td>
<td class="instruction">BIT 4,(HL)</td>
<td class="comment-1" rowspan="2">Jump to <a href="823B.html#82f4">Ticker_CheckAffordToFly</a> if the player is not "stranded" (doesn't have enough money to fly).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82dc"></span>82DC</td>
<td class="instruction">JR Z,<a href="823B.html#82f4">Ticker_CheckAffordToFly</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="82de"></span>
<div class="comments">
<div class="paragraph">
Player is stranded in their current location, so handle displaying the messaging in the ticker.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82de"></span>82DE</td>
<td class="instruction">RES 4,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 4 ("Stranded") of *<a href="EFFA.html">GameState_1</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="82e0"></span>
<div class="comments">
<div class="paragraph">
Build the string in the ticker buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82e0"></span>82E0</td>
<td class="instruction">LD HL,$8CC3</td>
<td class="comment-1" rowspan="2">Adds ... " stranded in " to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82e3"></span>82E3</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82e6"></span>82E6</td>
<td class="instruction">CALL <a href="836E.html">AddLocationTickerBuffer</a></td>
<td class="comment-1" rowspan="1">Add the current location name to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82e9"></span>82E9</td>
<td class="instruction">LD HL,$8CD0</td>
<td class="comment-1" rowspan="2">Adds ... ", penniless." to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82ec"></span>82EC</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82ef"></span>82EF</td>
<td class="instruction">LD A,$50</td>
<td class="comment-1" rowspan="2">Set the spacing to 50 and jump to <a href="837F.html">AddSpacingFillTickerBuffer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82f1"></span>82F1</td>
<td class="instruction">JP <a href="837F.html">AddSpacingFillTickerBuffer</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="82f4"></span>
<div class="comments">
<div class="paragraph">
Can the player not afford to fly?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Ticker_CheckAffordToFly</td>
<td class="address-2"><span id="82f4"></span>82F4</td>
<td class="instruction">BIT 5,(HL)</td>
<td class="comment-1" rowspan="2">Jump to <a href="823B.html#830e">Ticker_CheckGameWasCompleted</a> if the player can afford to fly to someplace else.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82f6"></span>82F6</td>
<td class="instruction">JR Z,<a href="823B.html#830e">Ticker_CheckGameWasCompleted</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="82f8"></span>
<div class="comments">
<div class="paragraph">
The player is broke and can't afford to fly to a new destination, so handle displaying this in the ticker.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82f8"></span>82F8</td>
<td class="instruction">RES 5,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 5 ("Can't Afford To Fly") of *<a href="EFFA.html">GameState_1</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="82fa"></span>
<div class="comments">
<div class="paragraph">
Build the string in the ticker buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82fa"></span>82FA</td>
<td class="instruction">LD HL,$8CC3</td>
<td class="comment-1" rowspan="2">Adds ... " stranded in " to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="82fd"></span>82FD</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8300"></span>8300</td>
<td class="instruction">CALL <a href="836E.html">AddLocationTickerBuffer</a></td>
<td class="comment-1" rowspan="1">Add the current location name to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8303"></span>8303</td>
<td class="instruction">LD HL,$8CDC</td>
<td class="comment-1" rowspan="2">Adds ... ", without fare home." to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8306"></span>8306</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8309"></span>8309</td>
<td class="instruction">LD A,$5A</td>
<td class="comment-1" rowspan="2">Set the spacing to 5A and jump to <a href="837F.html">AddSpacingFillTickerBuffer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="830b"></span>830B</td>
<td class="instruction">JP <a href="837F.html">AddSpacingFillTickerBuffer</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="830e"></span>
<div class="comments">
<div class="paragraph">
Has the player completed ALL the sub-games?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Ticker_CheckGameWasCompleted</td>
<td class="address-2"><span id="830e"></span>830E</td>
<td class="instruction">BIT 6,(HL)</td>
<td class="comment-1" rowspan="2">Jump to <a href="823B.html#8322">Ticker_CheckFlyingToNewDestination</a> if the player hasn't yet completed all the sub-games.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8310"></span>8310</td>
<td class="instruction">JR Z,<a href="823B.html#8322">Ticker_CheckFlyingToNewDestination</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8312"></span>
<div class="comments">
<div class="paragraph">
Player has completed all the sub-games, so handle displaying the messaging in the ticker.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8312"></span>8312</td>
<td class="instruction">RES 6,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 6 ("Completed All Locations") of *<a href="EFFA.html">GameState_1</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8314"></span>
<div class="comments">
<div class="paragraph">
Build the string in the ticker buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8314"></span>8314</td>
<td class="instruction">LD HL,$8DBC</td>
<td class="comment-1" rowspan="2">Adds ... " completes round world trip........... time machine found in " to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8317"></span>8317</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="831a"></span>831A</td>
<td class="instruction">CALL <a href="836E.html">AddLocationTickerBuffer</a></td>
<td class="comment-1" rowspan="1">Add the current location name to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="831d"></span>831D</td>
<td class="instruction">LD A,$78</td>
<td class="comment-1" rowspan="2">Set the spacing to 78 and jump to <a href="837F.html">AddSpacingFillTickerBuffer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="831f"></span>831F</td>
<td class="instruction">JP <a href="837F.html">AddSpacingFillTickerBuffer</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8322"></span>
<div class="comments">
<div class="paragraph">
Is the player flying somewhere new?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Ticker_CheckFlyingToNewDestination</td>
<td class="address-2"><span id="8322"></span>8322</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="2">Just return if the player is not flying somewhere new, there are no more conditions covered.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8324"></span>8324</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8325"></span>
<div class="comments">
<div class="paragraph">
Player is flying to a new destination, so handle displaying the messaging in the ticker.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8325"></span>8325</td>
<td class="instruction">RES 7,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 7 ("Flying To New Destination") of *<a href="EFFA.html">GameState_1</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8327"></span>
<div class="comments">
<div class="paragraph">
Build the string in the ticker buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8327"></span>8327</td>
<td class="instruction">LD HL,$8CBA</td>
<td class="comment-1" rowspan="2">Adds ... " flies to" to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="832a"></span>832A</td>
<td class="instruction">CALL <a href="839F.html">AddStringToBuffer</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="832d"></span>832D</td>
<td class="instruction">CALL <a href="836E.html">AddLocationTickerBuffer</a></td>
<td class="comment-1" rowspan="1">Add the current location name to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8330"></span>8330</td>
<td class="instruction">LD A,$46</td>
<td class="comment-1" rowspan="2">Set the spacing to 46 and jump to <a href="837F.html">AddSpacingFillTickerBuffer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8332"></span>8332</td>
<td class="instruction">JP <a href="837F.html">AddSpacingFillTickerBuffer</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8335"></span>
<div class="comments">
<div class="paragraph">
Adds the players bonus points count to the ticker.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">AddBonusPointsToTicker</td>
<td class="address-2"><span id="8335"></span>8335</td>
<td class="instruction">LD HL,$EFF8</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="EFF7.html#eff8">ActivePlayerCash_02</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8338"></span>8338</td>
<td class="instruction">LD IX,$EFFB</td>
<td class="comment-1" rowspan="1"><span class="register">IX</span>=<a href="EFFB.html">GameState_2</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="833c"></span>833C</td>
<td class="instruction">SET 4,(IX+$00)</td>
<td class="comment-1" rowspan="1">Set bit 4 ("Used for printing scores/ stripping off leading zeroes") of *<span class="register">IX</span>+00.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8340"></span>8340</td>
<td class="instruction">LD C,$02</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">C</span> for the number of digits (02).</td>
</tr>
<tr>
<td class="asm-label">ProcessBonusPointsDigit_Loop</td>
<td class="address-2"><span id="8342"></span>8342</td>
<td class="instruction">LD B,$02</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> for the count of how many score digits are to be processed in each score byte (02).</td>
</tr>
<tr>
<td class="asm-label">ProcessBonusPoints_Loop</td>
<td class="address-2"><span id="8344"></span>8344</td>
<td class="instruction">LD A,$30</td>
<td class="comment-1" rowspan="1">Load <span class="register">A</span> with ASCII "0" (30).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8346"></span>8346</td>
<td class="instruction">RLD</td>
<td class="comment-1" rowspan="1">Extract the score digit into the accumulator.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8348"></span>
<div class="comments">
<div class="paragraph">
Don't print any zeros while bit 4 is set, it's only unset when a printable digit is "found" (i.e. not a zero). Once it is, then the zero characters are set freely (e.g. we won't print 001, but we will print 100).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8348"></span>8348</td>
<td class="instruction">BIT 4,(IX+$00)</td>
<td class="comment-1" rowspan="2">Jump to <a href="823B.html#8356">WriteDigitToTickerBuffer</a> if bit 4 of *<span class="register">IX</span>+00 is not set.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="834c"></span>834C</td>
<td class="instruction">JR Z,<a href="823B.html#8356">WriteDigitToTickerBuffer</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="834e"></span>
<div class="comments">
<div class="paragraph">
Strip off leading zeros.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="834e"></span>834E</td>
<td class="instruction">CP $30</td>
<td class="comment-1" rowspan="2">Jump to <a href="823B.html#8358">BonusPointsProcessNextNumber</a> if the current digit is "0".</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8350"></span>8350</td>
<td class="instruction">JR Z,<a href="823B.html#8358">BonusPointsProcessNextNumber</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8352"></span>
<div class="comments">
<div class="paragraph">
The digit is not a zero, so flag and process.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8352"></span>8352</td>
<td class="instruction">RES 4,(IX+$00)</td>
<td class="comment-1" rowspan="1">Reset bit 4 ("Used for printing scores/ stripping off leading zeroes") of *<span class="register">IX</span>+00.</td>
</tr>
<tr>
<td class="asm-label">WriteDigitToTickerBuffer</td>
<td class="address-2"><span id="8356"></span>8356</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Write the digit to the ticker buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8357"></span>8357</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Increment the ticker buffer pointer by one.</td>
</tr>
<tr>
<td class="asm-label">BonusPointsProcessNextNumber</td>
<td class="address-2"><span id="8358"></span>8358</td>
<td class="instruction">DJNZ <a href="823B.html#8344">ProcessBonusPoints_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="823B.html#8344">ProcessBonusPoints_Loop</a> until counter is zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="835a"></span>
<div class="comments">
<div class="paragraph">
The score is evaluated backwards.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="835a"></span>835A</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Decrease the score pointer by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="835b"></span>835B</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1">Decrease the score digit counter by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="835c"></span>835C</td>
<td class="instruction">JR NZ,<a href="823B.html#8342">ProcessBonusPointsDigit_Loop</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="823B.html#8342">ProcessBonusPointsDigit_Loop</a> until both digits of the score have been processed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="835e"></span>835E</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="81D4.html">81D4</a>
</td>
<td class="up">Up: <a href="../maps/all.html#823b">Map</a></td>
<td class="next">
Next: <a href="835F.html">835F</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1984 New Generation Software &copy; 2024 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.3.</div>
<div class="repository">Link to <a href="https://github.com/pobtastic/travelwithtrashman/">Source code</a>.</div>
<div><a href="asm/823B.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>