<!DOCTYPE html>
<html>
<head>
<title>Travel With Trashman: Routine at 83AA</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="839F.html">839F</a>
</td>
<td class="up">Up: <a href="../maps/all.html#83aa">Map</a></td>
<td class="next">
Next: <a href="8479.html">8479</a>
</td>
</tr>
</table>
<div class="description">83AA: Game Selection Menu</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="8003.html">GameInitialise</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="83aa"></span>
<div class="comments">
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="main-menu" src="../images/scr/main-menu.png" /></td>
</tr>
</table>
</div>
<div class="paragraph">
Prints "Select controls".
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameMenu</td>
<td class="address-2"><span id="83aa"></span>83AA</td>
<td class="instruction">LD HL,$8B31</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="8B31.html">Messaging_SelectControls</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83ad"></span>83AD</td>
<td class="instruction">LD DE,$504B</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=504B (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83b0"></span>83B0</td>
<td class="instruction">CALL <a href="8A3D.html">Print_String</a></td>
<td class="comment-1" rowspan="1">Call <a href="8A3D.html">Print_String</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83b3"></span>83B3</td>
<td class="instruction">LD HL,$506B</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=506B (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83b6"></span>83B6</td>
<td class="instruction">LD B,$0F</td>
<td class="comment-1" rowspan="2"><a href="8A37.html">Underline</a> the header with 0F character blocks of FF.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83b8"></span>83B8</td>
<td class="instruction">CALL <a href="8A37.html">Underline</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="83bb"></span>
<div class="comments">
<div class="paragraph">
Prints "1 User defined keys".
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83bb"></span>83BB</td>
<td class="instruction">LD HL,$8B40</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="8B31.html#8b40">Messaging_UserDefinedKeys</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83be"></span>83BE</td>
<td class="instruction">LD DE,$5089</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=5089 (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83c1"></span>83C1</td>
<td class="instruction">CALL <a href="8A3D.html">Print_String</a></td>
<td class="comment-1" rowspan="1">Call <a href="8A3D.html">Print_String</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="83c4"></span>
<div class="comments">
<div class="paragraph">
Prints "2 Kempston joystick".
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83c4"></span>83C4</td>
<td class="instruction">LD HL,$8B53</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="8B31.html#8b53">Messaging_KempstonJoystick</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83c7"></span>83C7</td>
<td class="instruction">LD DE,$50A9</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=50A9 (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83ca"></span>83CA</td>
<td class="instruction">CALL <a href="8A3D.html">Print_String</a></td>
<td class="comment-1" rowspan="1">Call <a href="8A3D.html">Print_String</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="83cd"></span>
<div class="comments">
<div class="paragraph">
Prints "3 Interface 2".
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83cd"></span>83CD</td>
<td class="instruction">LD HL,$8B66</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="8B31.html#8b66">Messaging_Interface2</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83d0"></span>83D0</td>
<td class="instruction">LD DE,$50C9</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=50C9 (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83d3"></span>83D3</td>
<td class="instruction">CALL <a href="8A3D.html">Print_String</a></td>
<td class="comment-1" rowspan="1">Call <a href="8A3D.html">Print_String</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="83d6"></span>
<div class="comments">
<div class="paragraph">
Prints "4 Cursor key type J/S".
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83d6"></span>83D6</td>
<td class="instruction">LD HL,$8B73</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="8B31.html#8b73">Messaging_CursorKeys</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83d9"></span>83D9</td>
<td class="instruction">LD DE,$50E9</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=50E9 (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83dc"></span>83DC</td>
<td class="instruction">CALL <a href="8A3D.html">Print_String</a></td>
<td class="comment-1" rowspan="1">Call <a href="8A3D.html">Print_String</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="83df"></span>
<div class="comments">
<div class="paragraph">
Handle retrieving the players input.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameMenu_InputLoop</td>
<td class="address-2"><span id="83df"></span>83DF</td>
<td class="instruction">LD BC,$F7FE</td>
<td class="comment-1" rowspan="2">Read from the keyboard; <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">F7</td>
<td class="centre" colspan="1" rowspan="1">1</td>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="centre" colspan="1" rowspan="1">5</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83e2"></span>83E2</td>
<td class="instruction">IN A,(C)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83e4"></span>83E4</td>
<td class="instruction">OR %11100000</td>
<td class="comment-1" rowspan="1">Set bits 5-7 (to fill in the extra bits).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83e6"></span>83E6</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="2">Jump to <a href="83AA.html#83f1">GameMenu_HandleInput</a> if any of the keys have been pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83e8"></span>83E8</td>
<td class="instruction">JR NZ,<a href="83AA.html#83f1">GameMenu_HandleInput</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83ea"></span>83EA</td>
<td class="instruction">LD B,$05</td>
<td class="comment-1" rowspan="2">Call <a href="8055.html">8055</a> with a count of 05.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83ec"></span>83EC</td>
<td class="instruction">CALL <a href="8055.html">$8055</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83ef"></span>83EF</td>
<td class="instruction">JR <a href="83AA.html#83df">GameMenu_InputLoop</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="83AA.html#83df">GameMenu_InputLoop</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="83f1"></span>
<div class="comments">
<div class="paragraph">
Process the players input.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameMenu_HandleInput</td>
<td class="address-2"><span id="83f1"></span>83F1</td>
<td class="instruction">CP $FE</td>
<td class="comment-1" rowspan="2">Jump to <a href="83AA.html#841c">SetUserDefinedKeys</a> if <span class="register">A</span> is equal to FE.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83f3"></span>83F3</td>
<td class="instruction">JR Z,<a href="83AA.html#841c">SetUserDefinedKeys</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="83f5"></span>
<div class="comments">
<div class="paragraph">
Was Kempston joystick selected?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83f5"></span>83F5</td>
<td class="instruction">LD HL,$8E55</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="8E55.html">KeyMap_Kempston</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83f8"></span>83F8</td>
<td class="instruction">CP $FD</td>
<td class="comment-1" rowspan="2">Jump to <a href="83AA.html#8418">SetKempstonJoystick</a> if <span class="register">A</span> is equal to FD.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83fa"></span>83FA</td>
<td class="instruction">JR Z,<a href="83AA.html#8418">SetKempstonJoystick</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="83fc"></span>
<div class="comments">
<div class="paragraph">
Was Interface 2 joystick selected?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83fc"></span>83FC</td>
<td class="instruction">LD HL,$8E64</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="8E64.html">KeyMap_Interface2</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="83ff"></span>83FF</td>
<td class="instruction">CP $FB</td>
<td class="comment-1" rowspan="2">Jump to <a href="83AA.html#840a">SetNoOperation</a> if <span class="register">A</span> is equal to FB.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8401"></span>8401</td>
<td class="instruction">JR Z,<a href="83AA.html#840a">SetNoOperation</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8403"></span>
<div class="comments">
<div class="paragraph">
Was the Cursor joystick selected?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8403"></span>8403</td>
<td class="instruction">LD HL,$8E73</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="8E73.html">KeyMap_CursorKeys</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8406"></span>8406</td>
<td class="instruction">CP $F7</td>
<td class="comment-1" rowspan="2">Jump back to <a href="83AA.html#83df">GameMenu_InputLoop</a> if the cursor joystick was not selected.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8408"></span>8408</td>
<td class="instruction">JR NZ,<a href="83AA.html#83df">GameMenu_InputLoop</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="840a"></span>
<div class="comments">
<div class="paragraph">
Self-modifying code. See; <a href="85E7.html#85f4">HandleControlBits</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">SetNoOperation</td>
<td class="address-2"><span id="840a"></span>840A</td>
<td class="instruction">LD A,$00</td>
<td class="comment-1" rowspan="1">Write 00 (NOP) to *<a href="85E7.html#85f4">HandleControlBits</a>.</td>
</tr>
<tr>
<td class="asm-label">SetActiveKeyMap</td>
<td class="address-2"><span id="840c"></span>840C</td>
<td class="instruction">LD ($85F4),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<a href="85E7.html#85f4">HandleControlBits</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="840f"></span>840F</td>
<td class="instruction">LD DE,$EFE0</td>
<td class="comment-1" rowspan="3">Copy 000F bytes from *<span class="register">HL</span> to *<a href="EFE0.html">ActiveKeyMap</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8412"></span>8412</td>
<td class="instruction">LD BC,$000F</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8415"></span>8415</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8417"></span>8417</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8418"></span>
<div class="comments">
<div class="paragraph">
Self-modifying code. See; <a href="85E7.html#85f4">HandleControlBits</a>.
</div>
<div class="paragraph">
Invert the bits in the controls routine.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">SetKempstonJoystick</td>
<td class="address-2"><span id="8418"></span>8418</td>
<td class="instruction">LD A,$2F</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=2F (CPL) to *<a href="85E7.html#85f4">HandleControlBits</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="841a"></span>841A</td>
<td class="instruction">JR <a href="83AA.html#840c">SetActiveKeyMap</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="83AA.html#840c">SetActiveKeyMap</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="841c"></span>
<div class="comments">
<div class="paragraph">
Self-modifying code. See; <a href="85E7.html#85f4">HandleControlBits</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">SetUserDefinedKeys</td>
<td class="address-2"><span id="841c"></span>841C</td>
<td class="instruction">LD A,$00</td>
<td class="comment-1" rowspan="2">Write 00 (NOP) to *<a href="85E7.html#85f4">HandleControlBits</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="841e"></span>841E</td>
<td class="instruction">LD ($85F4),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8421"></span>8421</td>
<td class="instruction">CALL <a href="8A61.html#8a71">ClearBottomScreenArea</a></td>
<td class="comment-1" rowspan="1">Call <a href="8A61.html#8a71">ClearBottomScreenArea</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8424"></span>
<div class="comments">
<div class="paragraph">
Prints "Please select ".
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8424"></span>8424</td>
<td class="instruction">LD HL,$8B88</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="8B88.html">Messaging_PleaseSelectKeys</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8427"></span>8427</td>
<td class="instruction">LD DE,$50A7</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=50A7 (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="842a"></span>842A</td>
<td class="instruction">CALL <a href="8A3D.html">Print_String</a></td>
<td class="comment-1" rowspan="1">Call <a href="8A3D.html">Print_String</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="842d"></span>
<div class="comments">
<div class="paragraph">
Cycle through each key/ key messaging to collect the user input:
</div>
<div class="paragraph">
Using &quot;right key&quot;, &quot;down key&quot;, &quot;left key&quot;, &quot;up key&quot; and &quot;fire key&quot; strings.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="842d"></span>842D</td>
<td class="instruction">LD HL,$8B96</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="8B88.html#8b96">Messaging_RedefineKeys_Right</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8430"></span>8430</td>
<td class="instruction">LD B,$05</td>
<td class="comment-1" rowspan="1">Store a counter in <span class="register">B</span> of 05 for how many strings to print.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8432"></span>8432</td>
<td class="instruction">LD IX,$EFE0</td>
<td class="comment-1" rowspan="1"><span class="register">IX</span>=<a href="EFE0.html">ActiveKeyMap</a>.</td>
</tr>
<tr>
<td class="asm-label">SetKeys_Loop</td>
<td class="address-2"><span id="8436"></span>8436</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Stash the string counter and active keymap position on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8437"></span>8437</td>
<td class="instruction">PUSH IX</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8439"></span>8439</td>
<td class="instruction">LD DE,$50B5</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=50B5 (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="843c"></span>843C</td>
<td class="instruction">CALL <a href="8A3D.html">Print_String</a></td>
<td class="comment-1" rowspan="1">Call <a href="8A3D.html">Print_String</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="843f"></span>843F</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash the messaging pointer on the stack.</td>
</tr>
<tr>
<td class="asm-label">GameMenu_0</td>
<td class="address-2"><span id="8440"></span>8440</td>
<td class="instruction">CALL <a href="8479.html">PauseCheck</a></td>
<td class="comment-1" rowspan="1">Call <a href="8479.html">PauseCheck</a>.</td>
</tr>
<tr>
<td class="asm-label">GameMenu_1</td>
<td class="address-2"><span id="8443"></span>8443</td>
<td class="instruction">LD B,$05</td>
<td class="comment-1" rowspan="2">Call <a href="8055.html">8055</a> with a count of 05.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8445"></span>8445</td>
<td class="instruction">CALL <a href="8055.html">$8055</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8448"></span>8448</td>
<td class="instruction">LD BC,$FEFE</td>
<td class="comment-1" rowspan="2">Read from the keyboard; <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">FE</td>
<td class="centre" colspan="1" rowspan="1">SHIFT</td>
<td class="centre" colspan="1" rowspan="1">Z</td>
<td class="centre" colspan="1" rowspan="1">X</td>
<td class="centre" colspan="1" rowspan="1">C</td>
<td class="centre" colspan="1" rowspan="1">V</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label">GameMenu_2</td>
<td class="address-2"><span id="844b"></span>844B</td>
<td class="instruction">IN A,(C)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="844d"></span>844D</td>
<td class="instruction">OR %11100000</td>
<td class="comment-1" rowspan="1">Set bits 5-7 (to fill in the extra bits).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="844f"></span>844F</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="2">Jump to <a href="83AA.html#8459">GameMenu_3</a> if any of the keys have been pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8451"></span>8451</td>
<td class="instruction">JR NZ,<a href="83AA.html#8459">GameMenu_3</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8453"></span>8453</td>
<td class="instruction">RLC B</td>
<td class="comment-1" rowspan="1">Rotate <span class="register">B</span> left (with carry).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8455"></span>8455</td>
<td class="instruction">JR C,<a href="83AA.html#844b">GameMenu_2</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="83AA.html#844b">GameMenu_2</a> if <span class="register">A</span> is lower.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8457"></span>8457</td>
<td class="instruction">JR <a href="83AA.html#8443">GameMenu_1</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="83AA.html#8443">GameMenu_1</a>.</td>
</tr>
<tr>
<td class="asm-label">GameMenu_3</td>
<td class="address-2"><span id="8459"></span>8459</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="1">Invert the bits in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="845a"></span>845A</td>
<td class="instruction">AND %00011111</td>
<td class="comment-1" rowspan="1">Keep only bits 0-4.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="845c"></span>845C</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label">GameMenu_4</td>
<td class="address-2"><span id="845d"></span>845D</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="1">RRA.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="845e"></span>845E</td>
<td class="instruction">JR NC,<a href="83AA.html#845d">GameMenu_4</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="83AA.html#845d">GameMenu_4</a> if <span class="register">A</span> is higher.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8460"></span>8460</td>
<td class="instruction">CP $00</td>
<td class="comment-1" rowspan="2">Jump to <a href="83AA.html#8440">GameMenu_0</a> if <span class="register">A</span> is not equal to 00.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8462"></span>8462</td>
<td class="instruction">JR NZ,<a href="83AA.html#8440">GameMenu_0</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8464"></span>8464</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="2">Restore the messaging pointer and active keymap position from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8465"></span>8465</td>
<td class="instruction">POP IX</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8467"></span>8467</td>
<td class="instruction">LD (IX+$00),C</td>
<td class="comment-1" rowspan="3">Write the keymap data to the current active key.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="846a"></span>846A</td>
<td class="instruction">LD (IX+$01),B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="846d"></span>846D</td>
<td class="instruction">LD (IX+$02),E</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8470"></span>8470</td>
<td class="instruction">LD BC,$0003</td>
<td class="comment-1" rowspan="2">Add 0003 to <span class="register">IX</span> to move to the next key.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8473"></span>8473</td>
<td class="instruction">ADD IX,BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8475"></span>8475</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the string counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8476"></span>8476</td>
<td class="instruction">DJNZ <a href="83AA.html#8436">SetKeys_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease the string counter by one and loop back to <a href="83AA.html#8436">SetKeys_Loop</a> until all keys have been collected.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="8478"></span>8478</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="839F.html">839F</a>
</td>
<td class="up">Up: <a href="../maps/all.html#83aa">Map</a></td>
<td class="next">
Next: <a href="8479.html">8479</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1984 New Generation Software &copy; 2024 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.4.</div>
<div class="repository">Link to <a href="https://github.com/pobtastic/travelwithtrashman/">Source code</a>.</div>
<div><a href="asm/83AA.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>